// Composite Delphi Architecture
digraph {
	rankdir=BT
	splines=ortho
	nodesep=0.25 ranksep=0.3
	forcelabels=true
	subgraph cluster_inputs {
		style=invis
		Inputs [label="Structured Inputs
(Data, Shift, Total)" fillcolor=white fontname=Helvetica shape=plaintext]
		CompEmb [label="Token Embedding
(Composite)" fillcolor="#F8DDCC" fontname=Helvetica shape=box style="filled,rounded"]
		InputAdd [label="+" fixedsize=true fontname=Helvetica shape=circle style=solid width=0.4]
		AgeEmb [label="Age
Encoding" fillcolor="#FF9999" fixedsize=true fontname=Helvetica shape=circle style=filled width=0.9]
		Inputs -> CompEmb [fontname=Helvetica fontsize=10]
		CompEmb -> InputAdd [fontname=Helvetica fontsize=10]
		{
			rank=same
			AgeEmb
			InputAdd
			AgeEmb -> InputAdd [fontname=Helvetica fontsize=10]
		}
	}
	subgraph cluster_layer {
		bgcolor="#F2F3F4" color=black fontname=Helvetica label="Nx (12 Layers)" style=rounded
		Norm1 [label=RMSNorm fillcolor="#FEF9E7" fontname=Helvetica height=0.3 shape=box style="filled,rounded"]
		MaskedAttn [label="Masked Grouped
Query Attention (GQA)
(+RoPE, Sliding Window)" fillcolor="#FDEBD0" fontname=Helvetica shape=box style="filled,rounded"]
		Norm2 [label=RMSNorm fillcolor="#FEF9E7" fontname=Helvetica height=0.3 shape=box style="filled,rounded"]
		MoE [label="Mixture of Experts
(Router + 8 Experts)" fillcolor="#D6EAF8" fontname=Helvetica shape=box style="filled,rounded"]
		Norm1 -> MaskedAttn [fontname=Helvetica fontsize=10]
		MaskedAttn -> Norm2 [fontname=Helvetica fontsize=10 headlabel=Add labelangle=45 labeldistance=2.5 style=dashed]
		Norm2 -> MoE [fontname=Helvetica fontsize=10]
	}
	Out_DATA [label="Softmax
Next Token
(Class)" fillcolor="#D5F5E3" fontname=Helvetica shape=box style="filled,rounded"]
	Linear_DATA -> Out_DATA [fontname=Helvetica fontsize=10]
	Out_SHIFT [label="Softmax
Shift Value
(Class)" fillcolor="#D5F5E3" fontname=Helvetica shape=box style="filled,rounded"]
	Linear_SHIFT -> Out_SHIFT [fontname=Helvetica fontsize=10]
	Out_TOTAL [label="Output
Duration
(Regression)" fillcolor="#D5F5E3" fontname=Helvetica shape=box style="filled,rounded"]
	Linear_TOTAL -> Out_TOTAL [fontname=Helvetica fontsize=10]
	Out_TIME [label="Sampling
Time-to-Event
(Exp/Weibull)" fillcolor="#D5F5E3" fontname=Helvetica shape=box style="filled,rounded"]
	Linear_TIME -> Out_TIME [fontname=Helvetica fontsize=10]
	subgraph cluster_outputs {
		style=invis
		FinalNorm [label=RMSNorm fillcolor="#FEF9E7" fontname=Helvetica height=0.3 shape=box style="filled,rounded"]
		{
			rank=same
			Linear_DATA [label="Linear/MLP
(DATA Head)" fillcolor="#E8DAEF" fontname=Helvetica shape=box style="filled,rounded"]
			Linear_SHIFT [label="Linear/MLP
(SHIFT Head)" fillcolor="#E8DAEF" fontname=Helvetica shape=box style="filled,rounded"]
			Linear_TOTAL [label="Linear/MLP
(TOTAL Head)" fillcolor="#E8DAEF" fontname=Helvetica shape=box style="filled,rounded"]
			Linear_TIME [label="Linear/MLP
(TIME Head)" fillcolor="#E8DAEF" fontname=Helvetica shape=box style="filled,rounded"]
			Linear_DATA -> Linear_SHIFT [style=invis]
			Linear_SHIFT -> Linear_TOTAL [style=invis]
			Linear_TOTAL -> Linear_TIME [style=invis]
		}
	}
	InputAdd -> Norm1 [fontname=Helvetica fontsize=10]
	MoE -> FinalNorm [fontname=Helvetica fontsize=10 headlabel=Add labelangle=45 labeldistance=2.5 style=dashed]
	FinalNorm -> Linear_DATA [fontname=Helvetica fontsize=10]
	FinalNorm -> Linear_SHIFT [fontname=Helvetica fontsize=10]
	FinalNorm -> Linear_TOTAL [fontname=Helvetica fontsize=10]
	FinalNorm -> Linear_TIME [fontname=Helvetica fontsize=10]
}
